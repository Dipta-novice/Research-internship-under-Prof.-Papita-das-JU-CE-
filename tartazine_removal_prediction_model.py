# -*- coding: utf-8 -*-
"""Tartazine removal prediction model.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1lWYZqxrcjWjGxLUuH5m6gpYQDbu6DsGH
"""



import pandas as pd 
import numpy as np

from google.colab import files
uploaded=files.upload()

data=pd.read_excel('chem data2hj.xlsx')

data

x=data.iloc[:,0:3]
y=data.iloc[:,-1]

y

x

import tensorflow as tf

pip install keras-tuner

import kerastuner
from tensorflow import keras
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
from tensorflow.keras.optimizers import Adam
from kerastuner.tuners import RandomSearch

from sklearn.model_selection import train_test_split as tts

Xtrain,Xtest,ytrain,ytest=tts(x,y,test_size=0.1,random_state=42)

def model(hp):
  build_model=Sequential()
  build_model.add(Dense(units=hp.Int('n',min_value=16,max_value=512,step=16),activation='relu',input_dim=Xtrain.shape[1]))
  for i in range(hp.Int('nlayers',min_value=2,max_value=10)):
    build_model.add(Dense(units=hp.Int('units',min_value=16,max_value=256,step=16),activation='relu'))
  build_model.add(Dense(units=1,activation='linear'))
  build_model.compile(optimizer=Adam(hp.Choice('lr',[1e-2,1e-3,1e-4])),loss='mean_absolute_error',metrics=['mean_absolute_error'])
  return build_model

tuner=RandomSearch(model,objective='val_mean_absolute_error',max_trials=15,executions_per_trial=3,directory='output',project_name='chemann')

tuner.search(Xtrain,ytrain,epochs=50,validation_data=(Xtest,ytest),batch_size=2)

best_model=tuner.get_best_models(num_models=1)[0]

best_model.summary()

ypred=best_model.predict(Xtest)

ypred

ytest

from sklearn.metrics import mean_absolute_error as mae

print(mae(ytest,ypred))